<DialogueTree xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                  xsi:noNamespaceSchemaLocation="https://raw.githubusercontent.com/Outer-Wilds-New-Horizons/new-horizons/main/NewHorizons/Schemas/dialogue_schema.xsd">
  <NameField>Gatekeeper</NameField>

  <DialogueNode>
    <Name>Greeting</Name>
    <EntryCondition>DEFAULT</EntryCondition>
    <Dialogue>
      <Page>Greeings. I guard the entrance to this building.</Page>
    </Dialogue>
    <DialogueTarget>Init_0</DialogueTarget>
  </DialogueNode>

  <DialogueNode>
    <Name>First_Try_0</Name>
    <EntryCondition>SUNPOST_IN_RANGE</EntryCondition>
    <Dialogue>
      <Page>Greetings. I have not seen your kind around here.</Page>
      <Page>What is more intriguing than your unexpected arrival is how you knew the secret code.</Page>
    </Dialogue>

    <DialogueOptionsList>
      <DialogueOption>
        <Text>What secret code?</Text>
        <DialogueTarget>First_Try_00</DialogueTarget>
      </DialogueOption>
      <DialogueOption>
        <Text>Of course I know it.</Text>
        <DialogueTarget>First_Try_01</DialogueTarget>
      </DialogueOption>
    </DialogueOptionsList>
    <RevealFacts>
      <FactID>GHIRD_VILLAGE_A_PUZZLE_CODE</FactID>
    </RevealFacts>
  </DialogueNode>

  <DialogueNode>
    <Name>First_Try_00</Name>
    <Dialogue>
      <Page>You do not know of it?</Page>
      <Page>It must have been pure chance that you arrived at this moment, then.</Page>
      <Page>Return once you have figured out the code.</Page>
    </Dialogue>
  </DialogueNode>

  <DialogueNode>
    <Name>First_Try_01</Name>
    <Dialogue>
      <Page>Very well. Welcome to the hall of the Followers of Logic.</Page>
    </Dialogue>
    <SetPersistentCondition>OPEN_SUNPOST_DOOR</SetPersistentCondition>
    <SetPersistentCondition>ACCIDENTAL_SOLVE</SetPersistentCondition>
  </DialogueNode>

  <DialogueNode>
    <Name>Restart_0</Name>
    <EntryCondition>ACCIDENTAL_SOLVE</EntryCondition>
    <Dialogue>
      <Page>I hope you are proud of yourself for solving the code.</Page>
    </Dialogue>

    <DialogueOptionsList>
      <DialogueOption>
        <Text>What code?</Text>
        <DialogueTarget>Restart_00</DialogueTarget>
      </DialogueOption>
      <DialogueOption>
        <Text>I sure am!</Text>
        <DialogueTarget>Restart_01</DialogueTarget>
      </DialogueOption>
    </DialogueOptionsList>
  </DialogueNode>

  <DialogueNode>
    <Name>Restart_00</Name>
    <Dialogue>
      <Page>You do not know the code? Then it was only chance that you happened to speak to me at that moment.</Page>
      <Page>If you would like, I can close the door and let you solve the code.</Page>
    </Dialogue>

    <DialogueOptionsList>
      <DialogueOption>
        <Text>Sure.</Text>
        <DialogueTarget>Restart_000</DialogueTarget>
      </DialogueOption>
      <DialogueOption>
        <Text>I'm good.</Text>
        <DialogueTarget>Restart_001</DialogueTarget>
      </DialogueOption>
    </DialogueOptionsList>
  </DialogueNode>

  <DialogueNode>
    <Name>Restart_000</Name>
    <Dialogue>
      <Page>Excellent. Return when you have solved it.</Page>
    </Dialogue>
    <SetPersistentCondition>TALKED_TO_GHIRD_GATEKEEPER_A</SetPersistentCondition>
    <DisablePersistentCondition>OPEN_SUNPOST_DOOR</DisablePersistentCondition>
  </DialogueNode>

  <DialogueNode>
    <Name>Restart_001</Name>
    <Dialogue>
      <Page>Very well. I will keep these doors open for you.</Page>
      <Page>If you decide you would like to solve the puzzle, come speak to me.</Page>
    </Dialogue>
    <SetCondition>WAIT_FOR_CHANGED_MIND</SetCondition>
  </DialogueNode>

  <DialogueNode>
    <Name>Changed_Mind_0</Name>
    <EntryCondition>WAIT_FOR_CHANGED_MIND</EntryCondition>
    <Dialogue>
      <Page>Have you had a change of heart?</Page>
    </Dialogue>

    <DialogueOptionsList>
      <DialogueOption>
        <Text>Close the doors. I can solve the puzzle.</Text>
        <DialogueTarget>Restart_000</DialogueTarget>
      </DialogueOption>
      <DialogueOption>
        <Text>I'm not in the mood for puzzle solving today.</Text>
        <DialogueTarget>Restart_001</DialogueTarget>
      </DialogueOption>
    </DialogueOptionsList>
  </DialogueNode>

  <DialogueNode>
    <Name>Restart_01</Name>
    <Dialogue>
      <Page>Congragulations.</Page>
    </Dialogue>
  </DialogueNode>
  
  <DialogueNode>
    <Name>Init_0</Name>
    <Dialogue>
      <Page>Who wishes to enter?</Page>
    </Dialogue>

    <DialogueOptionsList>
      <DialogueOption>
        <Text>A stranger.</Text>
        <DialogueTarget>Init_00</DialogueTarget>
      </DialogueOption>
      <DialogueOption>
        <Text>A friend.</Text>
        <DialogueTarget>Init_01</DialogueTarget>
      </DialogueOption>
      <DialogueOption>
        <Text>Who's asking?</Text>
        <DialogueTarget>Init_02</DialogueTarget>
      </DialogueOption>
    </DialogueOptionsList>    
    <RevealFacts>
      <FactID>GHIRD_VILLAGE_A_PUZZLE_CODE</FactID>
    </RevealFacts>
    <SetPersistentCondition>TALKED_TO_GHIRD_GATEKEEPER_A</SetPersistentCondition>
  </DialogueNode>

  <DialogueNode>
    <Name>Init_00</Name>
    <Dialogue>
      <Page>No strangers may enter this building.</Page>
      <Page>Only those who know the secret code are granted passage.</Page>
      <Page>Come back at the correct time.</Page>
    </Dialogue>
    <RevealFacts>
      <FactID>GHIRD_VILLAGE_A_QUEST</FactID>
    </RevealFacts>
  </DialogueNode>

  <DialogueNode>
    <Name>Init_01</Name>
    <Dialogue>
      <Page>Then surely you must know of the secret code?</Page>
      <Page>Come back at the correct time.</Page>
    </Dialogue>
    <RevealFacts>
      <FactID>GHIRD_VILLAGE_A_QUEST</FactID>
    </RevealFacts>
  </DialogueNode>

  <DialogueNode>
    <Name>Init_02</Name>
    <Dialogue>
      <Page>The keeper of this gate.</Page>
      <Page>I only grant passage to those who know the secret code.</Page>
      <Page>Do you know what it is?</Page>
    </Dialogue>

    <DialogueOptionsList>
      <DialogueOption>
        <Text>No.</Text>
        <DialogueTarget>Init_020</DialogueTarget>
      </DialogueOption>
      <DialogueOption>
        <Text>Of course.</Text>
        <DialogueTarget>Init_021</DialogueTarget>
      </DialogueOption>
      <DialogueOption>
        <Text>What's the code again? I forgot.</Text>
        <DialogueTarget>Init_022</DialogueTarget>
      </DialogueOption>
    </DialogueOptionsList>
  </DialogueNode>

  <DialogueNode>
    <Name>Init_020</Name>
    <Dialogue>
      <Page>That is unfortunate for you.</Page>
      <Page>Only those who know it may enter.</Page>
    </Dialogue>
  </DialogueNode>

  <DialogueNode>
    <Name>Init_021</Name>
    <Dialogue>
      <Page>Perfect. Return at the correct time.</Page>
    </Dialogue>
    <RevealFacts>
      <FactID>GHIRD_VILLAGE_A_QUEST</FactID>
    </RevealFacts>
  </DialogueNode>

  <DialogueNode>
    <Name>Init_022</Name>
    <Dialogue>
      <Page>To forget the code is to prove yourself unworthy of it.</Page>
      <Page>If you do not know the code, you may not enter.</Page>
    </Dialogue>
  </DialogueNode>

  <DialogueNode>
    <Name>Code_Help_0</Name>
    <EntryCondition>TALKED_TO_GHIRD_GATEKEEPER_A</EntryCondition>
    <Dialogue>
      <Page>Have you figured out the code?</Page>
    </Dialogue>

    <DialogueOptionsList>
      <DialogueOption>
        <RequiredLogCondition>GHIRD_VILLAGE_A_PUZZLE_SHADOW</RequiredLogCondition>
        <Text>Does it have something to do with shadows?</Text>
        <DialogueTarget>Code_Help_00</DialogueTarget>
      </DialogueOption>
      <DialogueOption>
        <RequiredLogCondition>GHIRD_VILLAGE_A_PUZZLE_POST</RequiredLogCondition>
        <Text>Does it have something to do with that post on the other island?</Text>
        <DialogueTarget>Code_Help_01</DialogueTarget>
      </DialogueOption>
      <DialogueOption>
        <Text>I'm still figuring it out.</Text>
      </DialogueOption>
    </DialogueOptionsList>
  </DialogueNode>

  <DialogueNode>
    <Name>Code_Help_00</Name>
    <Dialogue>
      <Page>Shadows are only part of the puzzle. The rest is up to you to discover.</Page>
    </Dialogue>
    <DialogueTarget>Code_Help_0</DialogueTarget>
  </DialogueNode>

  <DialogueNode>
    <Name>Code_Help_01</Name>
    <Dialogue>
      <Page>The post is an essential part to the puzzle, yes.</Page>
    </Dialogue>
    <DialogueTarget>Code_Help_0</DialogueTarget>
  </DialogueNode>

  <DialogueNode>
    <Name>Entry_0</Name>
    <EntryCondition>SUNPOST_IN_RANGE</EntryCondition>
    <EntryCondition>TALKED_TO_GHIRD_GATEKEEPER_A</EntryCondition>
    <Dialogue>
      <Page>I see you have figured out the code. I expected you to take longer in solving it.</Page>
      <Page>Welcome to the hall of the Followers of Logic.</Page>
    </Dialogue>
    <RevealFacts>
      <FactID>GHIRD_VILLAGE_A_PUZZLE_SOLVED</FactID>
    </RevealFacts>
    <SetPersistentCondition>OPEN_SUNPOST_DOOR</SetPersistentCondition>
  </DialogueNode>
</DialogueTree>